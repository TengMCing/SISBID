<!DOCTYPE html>
<html>
  <head>
    <title>Grammar of Graphics and ggplot2</title>
    <meta charset="utf-8">
    <meta name="author" content="Di Cook (dicook@monash.edu, @visnut)   Heike Hofmann (heike.hofmann@gmail.com, @heike_hh)" />
    <link href="index_files/remark-css-0.0.1/default.css" rel="stylesheet" />
    <script src="index_files/htmlwidgets-1.2/htmlwidgets.js"></script>
    <script src="index_files/plotly-binding-4.7.1/plotly.js"></script>
    <script src="index_files/typedarray-0.1/typedarray.min.js"></script>
    <script src="index_files/jquery-1.11.3/jquery.min.js"></script>
    <link href="index_files/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
    <script src="index_files/crosstalk-1.0.0/js/crosstalk.min.js"></script>
    <link href="index_files/plotlyjs-1.29.2/plotly-htmlwidgets.css" rel="stylesheet" />
    <script src="index_files/plotlyjs-1.29.2/plotly-latest.min.js"></script>
    <link rel="stylesheet" href="myremark.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Grammar of Graphics and ggplot2
## SISBID 2018 <br> <a href="https://github.com/dicook/SISBID" class="uri">https://github.com/dicook/SISBID</a>
### Di Cook (<a href="mailto:dicook@monash.edu">dicook@monash.edu</a>, <span class="citation">@visnut</span>) <br> Heike Hofmann (<a href="mailto:heike.hofmann@gmail.com">heike.hofmann@gmail.com</a>, <span class="citation">@heike_hh</span>)
### 07/12-14/2018

---







class: inverse middle 
# Your turn: What is a data plot?

Write down as many types of data plots that you can. You've got 30 seconds.

---

&lt;img src="index_files/figure-html/unnamed-chunk-3-1.png" style="display: block; margin: auto;" /&gt;

---
# What is a data plot?

- data
- **aesthetics: mapping of variables to graphical elements**
- geom: type of plot structure to use
- transformations: log scale, ...
- layers: multiple geoms, multiple data sets, annotation
- facets: show subsets in different plots
- themes: modifying style

---
# Why?

With the grammar, a data plot becomes a statistic. It is a functional mapping from variable to graphical element. Then we can do statistics on data plots. 

With a grammar, we don't have individual animals in the zoo, we have the genetic code that says how one plot is related to another plot.

---
# Elements of the grammar

```
ggplot(data = &lt;DATA&gt;) + 
  &lt;GEOM_FUNCTION&gt;(
     mapping = aes(&lt;MAPPINGS&gt;),
     stat = &lt;STAT&gt;, 
     position = &lt;POSITION&gt;
  ) +
  &lt;COORDINATE_FUNCTION&gt; +
  &lt;FACET_FUNCTION&gt;
```

The 7 key elements of the grammar are:

- DATA
- GEOM_FUNCTION
- MAPPINGS
- STAT
- POSITION
- COORDINATE_FUNCTION
- FACET_FUNCTION

---
# Example: Tuberculosis data

This is current tuberculosis data taken from [WHO](http://www.who.int/tb/country/data/download/en/), the case notifications table.




```r
ggplot(tb_us, aes(x = year, y = count, fill = gender)) +
  geom_bar(stat = "identity", position = "fill") +
  facet_grid(~ age) +
  scale_fill_brewer(palette="Dark2")
```

&lt;img src="index_files/figure-html/unnamed-chunk-5-1.png" style="display: block; margin: auto;" /&gt;

---

100% charts, is what excel names these beasts. What do we learn?

- Focus is on **proportion** in each category. 
- Across all ages, and years, the proportion of males having TB is higher than females
- These proportions tend to be higher in the middle age groups, for all years.
- Relatively similar proportions across years.

---
# Bar charts


```r
ggplot(tb_us, aes(x = year, y = count, fill = gender)) +
  geom_bar(stat = "identity") +
  facet_grid(~ age) +
  scale_fill_brewer(palette="Dark2")
```

&lt;img src="index_files/figure-html/unnamed-chunk-6-1.png" style="display: block; margin: auto;" /&gt;

---

What do we learn?

- Focus is on **counts** in each category. 
- Different across ages, and years, counts tend to be lower in young age (15-24)
- Incidence has been decreasing although among younger age groups it is only in recent years.


---
# Side-by-side barcharts


```r
ggplot(tb_us, aes(x = year, y = count, fill = gender)) +
  geom_bar(stat = "identity", position="dodge") +
  facet_grid(~ age) +
  scale_fill_brewer(palette="Dark2")
```

&lt;img src="index_files/figure-html/unnamed-chunk-7-1.png" style="display: block; margin: auto;" /&gt;

---

What do we learn?

- Focus is on counts by gender, predominantly male incidence.
- There is similar incidence between males and females in younger age groups.
- Decline is less prominent among middle age females.

---
#  Separate bar charts


```r
ggplot(tb_us, aes(x = year, y = count, fill = gender)) +
  geom_bar(stat = "identity") +
  facet_grid(gender ~ age) +
  scale_fill_brewer(palette="Dark2")
```

&lt;img src="index_files/figure-html/unnamed-chunk-8-1.png" style="display: block; margin: auto;" /&gt;

---

What do we learn?

- Its easier to focus separately on males and females.

---
# Pie charts?


```r
ggplot(tb_us, aes(x = year, y = count, fill = gender)) +
  geom_bar(stat = "identity") +
  facet_grid(gender ~ age) +
  scale_fill_brewer(palette="Dark2") + 
  coord_polar() +
  theme(axis.text = element_blank())
```

&lt;img src="index_files/figure-html/unnamed-chunk-9-1.png" style="display: block; margin: auto;" /&gt;

---

Nope! That's a rose chart. Bar charts in polar coordinates produce rose charts. 

What do we learn?

- Emphasizes the difference between men and women, and really small numbers for middle aged females. 

---
# Rainbow charts?


```r
ggplot(tb_us, aes(x = 1, y = count, fill = factor(year))) +
  geom_bar(stat = "identity", position="fill") +
  facet_grid(gender ~ age) 
```

&lt;img src="index_files/figure-html/unnamed-chunk-10-1.png" style="display: block; margin: auto;" /&gt;

---

A single stacked bar, in each facet. Year is mapped to colour. 

What do we learn?

- Pretty chart but not easy to interpret. 

---
# Pie charts


```r
ggplot(tb_us, aes(x = 1, y = count, fill = factor(year))) +
  geom_bar(stat = "identity", position="fill") +
  facet_grid(gender ~ age) +
  coord_polar(theta="y") +
  theme(axis.text = element_blank())
```

&lt;img src="index_files/figure-html/unnamed-chunk-11-1.png" style="display: block; margin: auto;" /&gt;

---

What do we learn?

- Pretty chart but not easy to interpret, or make comparisons across age groups. 

---
class: inverse middle 
# Your turn

- Choose a different country to examine relative to tuberculosis incidence, for example, Australia. 
- Make a R Markdown notebook, for your analysis
- Create the same sequence of plots as done in slides 7-20 for your chosen country's data
- Write a paragraph describing what you have learned about tb in your chosen country from each plot. 


---
# Example 2: Platypus in Australia

Where can you find the strange platypus in Australia?

![](Platypus-sketch.jpg)

---




```r
load("../data/platypus.rda")
platydata &lt;- platypus$data
ggplot(data=platydata) + geom_point(aes(x=longitude, y=latitude))
```

&lt;img src="index_files/figure-html/unnamed-chunk-13-1.png" style="display: block; margin: auto;" /&gt;



---

Add some transparency to see density of locations.


```r
ggplot(data=platydata) + geom_point(aes(x=longitude, y=latitude), alpha=0.1)
```

&lt;img src="index_files/figure-html/unnamed-chunk-14-1.png" style="display: block; margin: auto;" /&gt;

---

If you are good at recognising the shape of Australia, you might realise that the sightings are all along the east coast and Tasmania. There is a strange location, that looks like someone saw one in Antarctica! We might need to filter this observation out later, because its extremely unlikely to have been found that far south.

But, we can make it look a bit more like Australia by making a map projection, using `coord_map`.

---



```r
ggplot(data=platydata) + 
  geom_point(aes(x=longitude, y=latitude), alpha=0.1) +
  coord_map()
```

&lt;img src="index_files/figure-html/unnamed-chunk-15-1.png" style="display: block; margin: auto;" /&gt;


The locations would be even more recognisable if we added a real map underneath. One way this can be done is to use a google map. The `ggmap` package has an interface to extracting google maps. Install it and then grab a map of Australia with this code.

---


```r
library(ggmap)
oz &lt;- get_map(location=c(lon=133.8807, lat=-23.6980), zoom=4)
ggmap(oz) + 
  geom_point(data=platydata, aes(x=longitude, y=latitude), 
              alpha=0.1, colour="orange")
```

&lt;img src="index_files/figure-html/unnamed-chunk-16-1.png" style="display: block; margin: auto;" /&gt;

---
class: inverse middle 
# Your turn

Change the dotplot into a density plot, to focus on the locations of frequent sightings.

Do you learn anything different than from the scatterplot?

---
class: inverse middle 
# Your turn

Platypus are mostly found on the east coast of the country, but there is a population close to Adelaide in south Australia. Why is this?

---
# Temporal trend

The date of the sighting is another variable in the data set. Let's make a plot of the sightings over time. The variable is called `eventDate`. It is considered to be a `character` variable by R, so the first step is to get R to recognise that it is a date time object.


```r
library(lubridate)
platydata &lt;- platydata %&gt;% 
  mutate(eventDate = ymd(eventDate))
```

---

then we can simply plot occurrence over time.


```r
ggplot(data=platydata) +
  geom_point(aes(x=eventDate, y=1))
```

&lt;img src="index_files/figure-html/unnamed-chunk-18-1.png" style="display: block; margin: auto;" /&gt;

---

There are some records dating back before 1800. There were only records from 1770! And these first records are in the database!



---

Let's focus on records since 1900, and count the number for each year.


```r
platydata1900 &lt;- platydata %&gt;% filter(year&gt;1900) %&gt;%
  count(year) 
ggplot(data=platydata1900) +
  geom_point(aes(x=year, y=n))
```

&lt;img src="index_files/figure-html/unnamed-chunk-20-1.png" style="display: block; margin: auto;" /&gt;

---

Add a trend line.


```r
ggplot(data=platydata1900, aes(x=year, y=n)) +
  geom_point() +
  geom_smooth(se=F)
```

&lt;img src="index_files/figure-html/unnamed-chunk-21-1.png" style="display: block; margin: auto;" /&gt;

---
Make it interactive so that we can investigate some observations.


```r
library(plotly)
ggplotly()
```

<div id="28573d0fe840" style="width:720px;height:432px;" class="plotly html-widget"></div>
<script type="application/json" data-for="28573d0fe840">{"x":{"data":[{"x":[1901,1903,1904,1905,1906,1907,1908,1909,1910,1911,1912,1913,1915,1917,1918,1919,1920,1921,1922,1923,1924,1925,1927,1928,1929,1930,1931,1932,1934,1935,1936,1937,1938,1939,1940,1941,1942,1943,1944,1945,1946,1947,1948,1949,1950,1951,1952,1953,1954,1955,1956,1957,1958,1959,1960,1961,1962,1963,1964,1965,1966,1967,1968,1969,1970,1971,1972,1973,1974,1975,1976,1977,1978,1979,1980,1981,1982,1983,1984,1985,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018],"y":[2,2,1,4,1,4,3,3,5,1,2,3,1,1,1,41,6,24,5,3,1,2,2,1,8,5,6,2,3,6,2,7,10,13,9,7,1,3,7,4,12,14,8,4,19,2,3,2,7,13,4,5,20,32,27,14,26,11,14,34,18,46,23,42,96,49,23,39,51,64,69,57,229,278,1068,80,47,51,71,51,98,99,118,106,200,167,155,122,361,215,227,212,316,112,86,225,311,83,1721,70,138,95,157,201,102,63,67,73,71,81,48,65,23],"text":["~year: 1901<br />~n:    2","~year: 1903<br />~n:    2","~year: 1904<br />~n:    1","~year: 1905<br />~n:    4","~year: 1906<br />~n:    1","~year: 1907<br />~n:    4","~year: 1908<br />~n:    3","~year: 1909<br />~n:    3","~year: 1910<br />~n:    5","~year: 1911<br />~n:    1","~year: 1912<br />~n:    2","~year: 1913<br />~n:    3","~year: 1915<br />~n:    1","~year: 1917<br />~n:    1","~year: 1918<br />~n:    1","~year: 1919<br />~n:   41","~year: 1920<br />~n:    6","~year: 1921<br />~n:   24","~year: 1922<br />~n:    5","~year: 1923<br />~n:    3","~year: 1924<br />~n:    1","~year: 1925<br />~n:    2","~year: 1927<br />~n:    2","~year: 1928<br />~n:    1","~year: 1929<br />~n:    8","~year: 1930<br />~n:    5","~year: 1931<br />~n:    6","~year: 1932<br />~n:    2","~year: 1934<br />~n:    3","~year: 1935<br />~n:    6","~year: 1936<br />~n:    2","~year: 1937<br />~n:    7","~year: 1938<br />~n:   10","~year: 1939<br />~n:   13","~year: 1940<br />~n:    9","~year: 1941<br />~n:    7","~year: 1942<br />~n:    1","~year: 1943<br />~n:    3","~year: 1944<br />~n:    7","~year: 1945<br />~n:    4","~year: 1946<br />~n:   12","~year: 1947<br />~n:   14","~year: 1948<br />~n:    8","~year: 1949<br />~n:    4","~year: 1950<br />~n:   19","~year: 1951<br />~n:    2","~year: 1952<br />~n:    3","~year: 1953<br />~n:    2","~year: 1954<br />~n:    7","~year: 1955<br />~n:   13","~year: 1956<br />~n:    4","~year: 1957<br />~n:    5","~year: 1958<br />~n:   20","~year: 1959<br />~n:   32","~year: 1960<br />~n:   27","~year: 1961<br />~n:   14","~year: 1962<br />~n:   26","~year: 1963<br />~n:   11","~year: 1964<br />~n:   14","~year: 1965<br />~n:   34","~year: 1966<br />~n:   18","~year: 1967<br />~n:   46","~year: 1968<br />~n:   23","~year: 1969<br />~n:   42","~year: 1970<br />~n:   96","~year: 1971<br />~n:   49","~year: 1972<br />~n:   23","~year: 1973<br />~n:   39","~year: 1974<br />~n:   51","~year: 1975<br />~n:   64","~year: 1976<br />~n:   69","~year: 1977<br />~n:   57","~year: 1978<br />~n:  229","~year: 1979<br />~n:  278","~year: 1980<br />~n: 1068","~year: 1981<br />~n:   80","~year: 1982<br />~n:   47","~year: 1983<br />~n:   51","~year: 1984<br />~n:   71","~year: 1985<br />~n:   51","~year: 1986<br />~n:   98","~year: 1987<br />~n:   99","~year: 1988<br />~n:  118","~year: 1989<br />~n:  106","~year: 1990<br />~n:  200","~year: 1991<br />~n:  167","~year: 1992<br />~n:  155","~year: 1993<br />~n:  122","~year: 1994<br />~n:  361","~year: 1995<br />~n:  215","~year: 1996<br />~n:  227","~year: 1997<br />~n:  212","~year: 1998<br />~n:  316","~year: 1999<br />~n:  112","~year: 2000<br />~n:   86","~year: 2001<br />~n:  225","~year: 2002<br />~n:  311","~year: 2003<br />~n:   83","~year: 2004<br />~n: 1721","~year: 2005<br />~n:   70","~year: 2006<br />~n:  138","~year: 2007<br />~n:   95","~year: 2008<br />~n:  157","~year: 2009<br />~n:  201","~year: 2010<br />~n:  102","~year: 2011<br />~n:   63","~year: 2012<br />~n:   67","~year: 2013<br />~n:   73","~year: 2014<br />~n:   71","~year: 2015<br />~n:   81","~year: 2016<br />~n:   48","~year: 2017<br />~n:   65","~year: 2018<br />~n:   23"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,0,0,1)","opacity":1,"size":5.66929133858268,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(0,0,0,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1901,1902.48101265823,1903.96202531646,1905.44303797468,1906.92405063291,1908.40506329114,1909.88607594937,1911.36708860759,1912.84810126582,1914.32911392405,1915.81012658228,1917.29113924051,1918.77215189873,1920.25316455696,1921.73417721519,1923.21518987342,1924.69620253165,1926.17721518987,1927.6582278481,1929.13924050633,1930.62025316456,1932.10126582278,1933.58227848101,1935.06329113924,1936.54430379747,1938.0253164557,1939.50632911392,1940.98734177215,1942.46835443038,1943.94936708861,1945.43037974684,1946.91139240506,1948.39240506329,1949.87341772152,1951.35443037975,1952.83544303797,1954.3164556962,1955.79746835443,1957.27848101266,1958.75949367089,1960.24050632911,1961.72151898734,1963.20253164557,1964.6835443038,1966.16455696203,1967.64556962025,1969.12658227848,1970.60759493671,1972.08860759494,1973.56962025316,1975.05063291139,1976.53164556962,1978.01265822785,1979.49367088608,1980.9746835443,1982.45569620253,1983.93670886076,1985.41772151899,1986.89873417722,1988.37974683544,1989.86075949367,1991.3417721519,1992.82278481013,1994.30379746835,1995.78481012658,1997.26582278481,1998.74683544304,2000.22784810127,2001.70886075949,2003.18987341772,2004.67088607595,2006.15189873418,2007.63291139241,2009.11392405063,2010.59493670886,2012.07594936709,2013.55696202532,2015.03797468354,2016.51898734177,2018],"y":[11.6023137064614,10.2061672692278,8.90276687017742,7.68851240887139,6.55980378487083,5.51304089773642,4.54462364702932,3.65095193231054,2.82842565314108,2.07344470908195,1.38240899969425,0.751718424538775,0.167918423326744,-0.416354546678935,-0.986618907191642,-1.51904041215806,-1.98978481552485,-2.37501787123866,-2.65090533324627,-2.79361295549429,-2.77930649192941,-2.58415169649831,-2.18431432314765,-1.77230446094492,-1.8403201918404,-2.25013092585095,-2.82813039430997,-3.40071232855084,-3.79427045990696,-3.83519851971172,-3.34989023929863,-2.16473935000096,-0.123166126855271,2.55318269670115,5.70812854125751,9.29686394602355,13.2745814502084,17.5964735930229,22.2177329136764,27.0935519513784,32.1791232453389,37.4296393347674,43.0547800431356,49.4633492585294,56.5328809006125,64.126719798076,72.1082107796117,80.3406986739114,88.6875283096671,97.0120445155707,105.177592120313,113.197504107794,122.510897634004,133.084618649909,144.379680627716,155.857097039632,166.977881357862,177.203047054613,185.993607602093,192.810576472509,197.114967138066,199.533329016322,201.467723935155,202.852096435576,203.608518684954,203.659062850653,202.925801100041,201.330805600485,198.796148519349,195.243902024002,190.610621710622,184.960323903403,178.334446216994,170.758463632101,162.257851129434,152.858083689698,142.584636293603,131.462983921854,119.51860155516,106.776964174227],"text":["~year: 1901.000<br />~n:  11.6023137","~year: 1902.481<br />~n:  10.2061673","~year: 1903.962<br />~n:   8.9027669","~year: 1905.443<br />~n:   7.6885124","~year: 1906.924<br />~n:   6.5598038","~year: 1908.405<br />~n:   5.5130409","~year: 1909.886<br />~n:   4.5446236","~year: 1911.367<br />~n:   3.6509519","~year: 1912.848<br />~n:   2.8284257","~year: 1914.329<br />~n:   2.0734447","~year: 1915.810<br />~n:   1.3824090","~year: 1917.291<br />~n:   0.7517184","~year: 1918.772<br />~n:   0.1679184","~year: 1920.253<br />~n:  -0.4163545","~year: 1921.734<br />~n:  -0.9866189","~year: 1923.215<br />~n:  -1.5190404","~year: 1924.696<br />~n:  -1.9897848","~year: 1926.177<br />~n:  -2.3750179","~year: 1927.658<br />~n:  -2.6509053","~year: 1929.139<br />~n:  -2.7936130","~year: 1930.620<br />~n:  -2.7793065","~year: 1932.101<br />~n:  -2.5841517","~year: 1933.582<br />~n:  -2.1843143","~year: 1935.063<br />~n:  -1.7723045","~year: 1936.544<br />~n:  -1.8403202","~year: 1938.025<br />~n:  -2.2501309","~year: 1939.506<br />~n:  -2.8281304","~year: 1940.987<br />~n:  -3.4007123","~year: 1942.468<br />~n:  -3.7942705","~year: 1943.949<br />~n:  -3.8351985","~year: 1945.430<br />~n:  -3.3498902","~year: 1946.911<br />~n:  -2.1647394","~year: 1948.392<br />~n:  -0.1231661","~year: 1949.873<br />~n:   2.5531827","~year: 1951.354<br />~n:   5.7081285","~year: 1952.835<br />~n:   9.2968639","~year: 1954.316<br />~n:  13.2745815","~year: 1955.797<br />~n:  17.5964736","~year: 1957.278<br />~n:  22.2177329","~year: 1958.759<br />~n:  27.0935520","~year: 1960.241<br />~n:  32.1791232","~year: 1961.722<br />~n:  37.4296393","~year: 1963.203<br />~n:  43.0547800","~year: 1964.684<br />~n:  49.4633493","~year: 1966.165<br />~n:  56.5328809","~year: 1967.646<br />~n:  64.1267198","~year: 1969.127<br />~n:  72.1082108","~year: 1970.608<br />~n:  80.3406987","~year: 1972.089<br />~n:  88.6875283","~year: 1973.570<br />~n:  97.0120445","~year: 1975.051<br />~n: 105.1775921","~year: 1976.532<br />~n: 113.1975041","~year: 1978.013<br />~n: 122.5108976","~year: 1979.494<br />~n: 133.0846186","~year: 1980.975<br />~n: 144.3796806","~year: 1982.456<br />~n: 155.8570970","~year: 1983.937<br />~n: 166.9778814","~year: 1985.418<br />~n: 177.2030471","~year: 1986.899<br />~n: 185.9936076","~year: 1988.380<br />~n: 192.8105765","~year: 1989.861<br />~n: 197.1149671","~year: 1991.342<br />~n: 199.5333290","~year: 1992.823<br />~n: 201.4677239","~year: 1994.304<br />~n: 202.8520964","~year: 1995.785<br />~n: 203.6085187","~year: 1997.266<br />~n: 203.6590629","~year: 1998.747<br />~n: 202.9258011","~year: 2000.228<br />~n: 201.3308056","~year: 2001.709<br />~n: 198.7961485","~year: 2003.190<br />~n: 195.2439020","~year: 2004.671<br />~n: 190.6106217","~year: 2006.152<br />~n: 184.9603239","~year: 2007.633<br />~n: 178.3344462","~year: 2009.114<br />~n: 170.7584636","~year: 2010.595<br />~n: 162.2578511","~year: 2012.076<br />~n: 152.8580837","~year: 2013.557<br />~n: 142.5846363","~year: 2015.038<br />~n: 131.4629839","~year: 2016.519<br />~n: 119.5186016","~year: 2018.000<br />~n: 106.7769642"],"type":"scatter","mode":"lines","name":"fitted values","line":{"width":3.77952755905512,"color":"rgba(51,102,255,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":28.1765601217656,"r":7.30593607305936,"b":42.130898021309,"l":48.9497716894977},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xaxis":{"domain":[0,1],"type":"linear","autorange":false,"range":[1895.15,2023.85],"tickmode":"array","ticktext":["1900","1925","1950","1975","2000"],"tickvals":[1900,1925,1950,1975,2000],"categoryorder":"array","categoryarray":["1900","1925","1950","1975","2000"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":null,"gridwidth":0,"zeroline":false,"anchor":"y","title":"year","titlefont":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"type":"linear","autorange":false,"range":[-90.0769584456973,1807.24175992599],"tickmode":"array","ticktext":["0","500","1000","1500"],"tickvals":[0,500,1000,1500],"categoryorder":"array","categoryarray":["0","500","1000","1500"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":null,"gridwidth":0,"zeroline":false,"anchor":"x","title":"n","titlefont":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":[{"name":"Collaborate","icon":{"width":1000,"ascent":500,"descent":-50,"path":"M487 375c7-10 9-23 5-36l-79-259c-3-12-11-23-22-31-11-8-22-12-35-12l-263 0c-15 0-29 5-43 15-13 10-23 23-28 37-5 13-5 25-1 37 0 0 0 3 1 7 1 5 1 8 1 11 0 2 0 4-1 6 0 3-1 5-1 6 1 2 2 4 3 6 1 2 2 4 4 6 2 3 4 5 5 7 5 7 9 16 13 26 4 10 7 19 9 26 0 2 0 5 0 9-1 4-1 6 0 8 0 2 2 5 4 8 3 3 5 5 5 7 4 6 8 15 12 26 4 11 7 19 7 26 1 1 0 4 0 9-1 4-1 7 0 8 1 2 3 5 6 8 4 4 6 6 6 7 4 5 8 13 13 24 4 11 7 20 7 28 1 1 0 4 0 7-1 3-1 6-1 7 0 2 1 4 3 6 1 1 3 4 5 6 2 3 3 5 5 6 1 2 3 5 4 9 2 3 3 7 5 10 1 3 2 6 4 10 2 4 4 7 6 9 2 3 4 5 7 7 3 2 7 3 11 3 3 0 8 0 13-1l0-1c7 2 12 2 14 2l218 0c14 0 25-5 32-16 8-10 10-23 6-37l-79-259c-7-22-13-37-20-43-7-7-19-10-37-10l-248 0c-5 0-9-2-11-5-2-3-2-7 0-12 4-13 18-20 41-20l264 0c5 0 10 2 16 5 5 3 8 6 10 11l85 282c2 5 2 10 2 17 7-3 13-7 17-13z m-304 0c-1-3-1-5 0-7 1-1 3-2 6-2l174 0c2 0 4 1 7 2 2 2 4 4 5 7l6 18c0 3 0 5-1 7-1 1-3 2-6 2l-173 0c-3 0-5-1-8-2-2-2-4-4-4-7z m-24-73c-1-3-1-5 0-7 2-2 3-2 6-2l174 0c2 0 5 0 7 2 3 2 4 4 5 7l6 18c1 2 0 5-1 6-1 2-3 3-5 3l-174 0c-3 0-5-1-7-3-3-1-4-4-5-6z"},"click":"function(gd) { \n        // is this being viewed in RStudio?\n        if (location.search == '?viewer_pane=1') {\n          alert('To learn about plotly for collaboration, visit:\\n https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html');\n        } else {\n          window.open('https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html', '_blank');\n        }\n      }"}],"cloud":false},"source":"A","attrs":{"28575a4e12ae":{"x":{},"y":{},"type":"scatter"},"28573bac8bd3":{"x":{},"y":{}}},"cur_data":"28575a4e12ae","visdat":{"28575a4e12ae":["function (y) ","x"],"28573bac8bd3":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1}},"base_url":"https://plot.ly"},"evals":["config.modeBarButtonsToAdd.0.click"],"jsHooks":{"render":[{"code":"function(el, x) { var ctConfig = crosstalk.var('plotlyCrosstalkOpts').set({\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.2,\"selected\":{\"opacity\":1}}); }","data":null}]}}</script>

---
class: inverse middle 
# Your turn

*Discussion question:* Was there a population explosion in 1980 and 2004? Is the population of platypus increasing since 1900, and decreasing in the last decade?

---
class: inverse middle 
# Your turn

- Subset the data to 1960-2010
- Create a new variable for decade
- Make a map separately for each decade - the `facet_wrap` function can help here.

---
# Example 3: Flying etiquette

[41% Of Fliers Think You’re Rude If You Recline Your Seat](http://fivethirtyeight.com/datalab/airplane-etiquette-recline-seat/)


```
Observations: 1,040
Variables: 27
$ RespondentID                                                                                                                               &lt;dbl&gt; ...
$ `How often do you travel by plane?`                                                                                                        &lt;chr&gt; ...
$ `Do you ever recline your seat when you fly?`                                                                                              &lt;chr&gt; ...
$ `How tall are you?`                                                                                                                        &lt;int&gt; ...
$ `Do you have any children under 18?`                                                                                                       &lt;chr&gt; ...
$ `In a row of three seats, who should get to use the two arm rests?`                                                                        &lt;chr&gt; ...
$ `In a row of two seats, who should get to use the middle arm rest?`                                                                        &lt;chr&gt; ...
$ `Who should have control over the window shade?`                                                                                           &lt;chr&gt; ...
$ `Is itrude to move to an unsold seat on a plane?`                                                                                          &lt;chr&gt; ...
$ `Generally speaking, is it rude to say more than a few words tothe stranger sitting next to you on a plane?`                               &lt;chr&gt; ...
$ `On a 6 hour flight from NYC to LA, how many times is it acceptable to get up if you're not in an aisle seat?`                             &lt;chr&gt; ...
$ `Under normal circumstances, does a person who reclines their seat during a flight have any obligation to the person sitting behind them?` &lt;chr&gt; ...
$ `Is itrude to recline your seat on a plane?`                                                                                               &lt;chr&gt; ...
$ `Given the opportunity, would you eliminate the possibility of reclining seats on planes entirely?`                                        &lt;chr&gt; ...
$ `Is it rude to ask someone to switch seats with you in order to be closer to friends?`                                                     &lt;chr&gt; ...
$ `Is itrude to ask someone to switch seats with you in order to be closer to family?`                                                       &lt;chr&gt; ...
$ `Is it rude to wake a passenger up if you are trying to go to the bathroom?`                                                               &lt;chr&gt; ...
$ `Is itrude to wake a passenger up if you are trying to walk around?`                                                                       &lt;chr&gt; ...
$ `In general, is itrude to bring a baby on a plane?`                                                                                        &lt;chr&gt; ...
$ `In general, is it rude to knowingly bring unruly children on a plane?`                                                                    &lt;chr&gt; ...
$ `Have you ever used personal electronics during take off or landing in violation of a flight attendant's direction?`                       &lt;chr&gt; ...
$ `Have you ever smoked a cigarette in an airplane bathroom when it was against the rules?`                                                  &lt;chr&gt; ...
$ Gender                                                                                                                                     &lt;chr&gt; ...
$ Age                                                                                                                                        &lt;chr&gt; ...
$ `Household Income`                                                                                                                         &lt;chr&gt; ...
$ Education                                                                                                                                  &lt;chr&gt; ...
$ `Location (Census Region)`                                                                                                                 &lt;chr&gt; ...
```

---
# Variables

- Mix of categorical and quantiative variables. 
- What mappings are appropriate? 
- Area for counts of categories, 
- side-by-side boxplots for mixed pair. 

---
# Support

&lt;img src="index_files/figure-html/unnamed-chunk-24-1.png" style="display: block; margin: auto;" /&gt;

Categories are not sorted

---
# Sorted categories

&lt;img src="index_files/figure-html/unnamed-chunk-25-1.png" style="display: block; margin: auto;" /&gt;&lt;img src="index_files/figure-html/unnamed-chunk-25-2.png" style="display: block; margin: auto;" /&gt;

---
# Filter data



---
# Recline by height

&lt;img src="index_files/figure-html/unnamed-chunk-27-1.png" style="display: block; margin: auto;" /&gt;


---
class: inverse middle 
# Your turn

![](lorikeets.png)

- Take a look at the ggplot2 [Cheat sheet](https://www.rstudio.com/wp-content/uploads/2016/11/ggplot2-cheatsheet-2.1.pdf)
- How many geoms are available in ggplot2? What is `geom_rug`?




---
class: inverse middle 
# Your turn

![](lorikeets.png)


What is the difference between `colour` and `fill`?



---
class: inverse middle 
# Your turn

![](lorikeets.png)

What does `coord_fixed()` do? What is the difference between this and using `theme(aspect.ratio=...)`?



---
class: inverse middle 
# Your turn

![](lorikeets.png)

What are scales? How many numeric transformation scales are there?



---
class: inverse middle 
# Your turn

![](lorikeets.png)

What are position adjustments? When would they be used?



---
class: inverse middle 
# Your turn 

![](lorikeets.png)

Use your cheat sheet to work out how to make plot to explore the relationship between 

`Do you ever recline your seat when you fly?` and `Is it rude to recline your seat on a plane?`





---
# Facets

&lt;img src="index_files/figure-html/unnamed-chunk-34-1.png" style="display: block; margin: auto;" /&gt;

---
# Facets

&lt;img src="index_files/figure-html/unnamed-chunk-35-1.png" style="display: block; margin: auto;" /&gt;

---
# Color palettes - default

&lt;img src="index_files/figure-html/unnamed-chunk-36-1.png" style="display: block; margin: auto;" /&gt;

What do we learn?

---
# Color palettes - brewer

&lt;img src="index_files/figure-html/unnamed-chunk-37-1.png" style="display: block; margin: auto;" /&gt;

---
# Color blind-proofing



---

![](index_files/figure-html/unnamed-chunk-39-1.png)![](index_files/figure-html/unnamed-chunk-39-2.png)

---
# Perceptual principles

- Hierarchy of mappings: (first) position along an axis - (last) color (Cleveland, 1984; Heer and Bostock, 2009)
- Pre-attentive: Some elements are noticed before you even realise it.
- Color: (pre-attentive) palettes - qualitative, sequential, diverging.
- Proximity: Place elements for primary comparison close together. 
- Change blindness: When focus is interrupted differences may not be noticed.

---
# Hierarchy of mappings

- 1.Position - common scale (BEST)
- 2.Position - nonaligned scale
- 3.Length, direction, angle
- 4.Area
- 5.Volume, curvature
- 6.Shading, color (WORST)

---
# Pre-attentive

Can you find the odd one out?

&lt;img src="index_files/figure-html/unnamed-chunk-40-1.png" style="display: block; margin: auto;" /&gt;

---

Is it easier now?

&lt;img src="index_files/figure-html/unnamed-chunk-41-1.png" style="display: block; margin: auto;" /&gt;


---
# Color palettes

- Qualitative: categorical variables
- Sequential: low to high numeric values
- Diverging: negative to positive values

---

&lt;img src="index_files/figure-html/unnamed-chunk-42-1.png" style="display: block; margin: auto;" /&gt;


---
# Proximity



With this arrangement we can see proportion of gender within each rudeness category, and compare these across age groups.  How could we arrange this differently?

---


&lt;img src="index_files/figure-html/unnamed-chunk-44-1.png" style="display: block; margin: auto;" /&gt;


---
# Proximity



---

&lt;img src="index_files/figure-html/unnamed-chunk-46-1.png" style="display: block; margin: auto;" /&gt;

What is different about the comparison now?

---
# Another arrangement



---

&lt;img src="index_files/figure-html/unnamed-chunk-48-1.png" style="display: block; margin: auto;" /&gt;

---
# Themes

The `ggthemes` package has many different styles for the plots. Other packages such as `xkcd`, `skittles`, `wes anderson`, `beyonce`, ....



See the [vignette](https://cran.r-project.org/web/packages/xkcd/vignettes/xkcd-intro.pdf) for instructions on installing the xkcd font. 

---

&lt;img src="index_files/figure-html/unnamed-chunk-50-1.png" style="display: block; margin: auto;" /&gt;

---
class: inverse middle 
# Your turn

![](lorikeets.png)

Compile the rmarkdown document that you have put together thus far in the workshop!

---
# Resources

- [RStudio cheatsheets](https://www.rstudio.com/resources/cheatsheets/)
- [ggplot2: Elegant Graphics for Data Analysis, Hadley Wickham](http://ggplot2.org/book/), [web site](http://ggplot2.org)
- [R Graphics Cookbook, Winston Chang](http://www.cookbook-r.com/Graphs/)
- [Naomi Robbins, Creating More Effective Graphs](http://www.nbr-graphs.com)
- [Antony Unwin, Graphical Data Analysis with R](https://www.crcpress.com/Graphical-Data-Analysis-with-R/Unwin/9781498715232)

---
# Share and share alike

This work is licensed under the Creative Commons Attribution-Noncommercial 3.0 United States License. To view a copy of this license, visit http://creativecommons.org/licenses/by-nc/3.0/us/ or send a letter to Creative Commons, 171 Second Street, Suite 300, San Francisco, California, 94105, USA.
    </textarea>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function() {
  var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})();</script>

<script>
(function() {
  var i, text, code, codes = document.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
})();
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
