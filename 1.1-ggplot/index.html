<!DOCTYPE html>
<html>
  <head>
    <title>Grammar of Graphics and ggplot2</title>
    <meta charset="utf-8">
    <meta name="author" content="Di Cook (dicook@monash.edu, @visnut)   Heike Hofmann (heike.hofmann@gmail.com, @heike_hh)" />
    <link href="index_files/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link rel="stylesheet" href="myremark.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Grammar of Graphics and ggplot2
## SISBID 2018 <br> <a href="https://github.com/dicook/SISBID" class="uri">https://github.com/dicook/SISBID</a>
### Di Cook (<a href="mailto:dicook@monash.edu">dicook@monash.edu</a>, <span class="citation">@visnut</span>) <br> Heike Hofmann (<a href="mailto:heike.hofmann@gmail.com">heike.hofmann@gmail.com</a>, <span class="citation">@heike_hh</span>)
### 07/12-14/2018

---







class: inverse middle 
# Your turn: What is a data plot?

Write down as many types of data plots that you can. You've got 30 seconds.

---

&lt;img src="index_files/figure-html/unnamed-chunk-3-1.png" style="display: block; margin: auto;" /&gt;

---
# What is a data plot?

- data
- **aesthetics: mapping of variables to graphical elements**
- geom: type of plot structure to use
- transformations: log scale, ...
- layers: multiple geoms, multiple data sets, annotation
- facets: show subsets in different plots
- themes: modifying style

---
# Why?

With the grammar, a data plot becomes a statistic. It is a functional mapping from variable to graphical element. Then we can do statistics on data plots. 

With a grammar, we don't have individual animals in the zoo, we have the genetic code that says how one plot is related to another plot.

---
# Elements of the grammar

```
ggplot(data = &lt;DATA&gt;) + 
  &lt;GEOM_FUNCTION&gt;(
     mapping = aes(&lt;MAPPINGS&gt;),
     stat = &lt;STAT&gt;, 
     position = &lt;POSITION&gt;
  ) +
  &lt;COORDINATE_FUNCTION&gt; +
  &lt;FACET_FUNCTION&gt;
```

The 7 key elements of the grammar are:

- DATA
- GEOM_FUNCTION
- MAPPINGS
- STAT
- POSITION
- COORDINATE_FUNCTION
- FACET_FUNCTION

---
# Example: Tuberculosis data

This is current tuberculosis data taken from [WHO](http://www.who.int/tb/country/data/download/en/), the case notifications table.




```r
ggplot(tb_us, aes(x = year, y = count, fill = gender)) +
  geom_bar(stat = "identity", position = "fill") +
  facet_grid(~ age) +
  scale_fill_brewer(palette="Dark2")
```

&lt;img src="index_files/figure-html/unnamed-chunk-5-1.png" style="display: block; margin: auto;" /&gt;

---

100% charts, is what excel names these beasts. What do we learn?

- Focus is on **proportion** in each category. 
- Across all ages, and years, the proportion of males having TB is higher than females
- These proportions tend to be higher in the middle age groups, for all years.
- Relatively similar proportions across years.

---
# Bar charts


```r
ggplot(tb_us, aes(x = year, y = count, fill = gender)) +
  geom_bar(stat = "identity") +
  facet_grid(~ age) +
  scale_fill_brewer(palette="Dark2")
```

&lt;img src="index_files/figure-html/unnamed-chunk-6-1.png" style="display: block; margin: auto;" /&gt;

---

What do we learn?

- Focus is on **counts** in each category. 
- Different across ages, and years, counts tend to be lower in young age (15-24)
- Incidence has been decreasing although among younger age groups it is only in recent years.


---
# Side-by-side barcharts


```r
ggplot(tb_us, aes(x = year, y = count, fill = gender)) +
  geom_bar(stat = "identity", position="dodge") +
  facet_grid(~ age) +
  scale_fill_brewer(palette="Dark2")
```

&lt;img src="index_files/figure-html/unnamed-chunk-7-1.png" style="display: block; margin: auto;" /&gt;

---

What do we learn?

- Focus is on counts by gender, predominantly male incidence.
- There is similar incidence between males and females in younger age groups.
- Decline is less prominent among middle age females.

---
#  Separate bar charts


```r
ggplot(tb_us, aes(x = year, y = count, fill = gender)) +
  geom_bar(stat = "identity") +
  facet_grid(gender ~ age) +
  scale_fill_brewer(palette="Dark2")
```

&lt;img src="index_files/figure-html/unnamed-chunk-8-1.png" style="display: block; margin: auto;" /&gt;

---

What do we learn?

- Its easier to focus separately on males and females.

---
# Pie charts?


```r
ggplot(tb_us, aes(x = year, y = count, fill = gender)) +
  geom_bar(stat = "identity") +
  facet_grid(gender ~ age) +
  scale_fill_brewer(palette="Dark2") + 
  coord_polar() +
  theme(axis.text = element_blank())
```

&lt;img src="index_files/figure-html/unnamed-chunk-9-1.png" style="display: block; margin: auto;" /&gt;

---

Nope! That's a rose chart. Bar charts in polar coordinates produce rose charts. 

What do we learn?

- Emphasizes the difference between men and women, and really small numbers for middle aged females. 

---
# Rainbow charts?


```r
ggplot(tb_us, aes(x = 1, y = count, fill = factor(year))) +
  geom_bar(stat = "identity", position="fill") +
  facet_grid(gender ~ age) 
```

&lt;img src="index_files/figure-html/unnamed-chunk-10-1.png" style="display: block; margin: auto;" /&gt;

---

A single stacked bar, in each facet. Year is mapped to colour. 

What do we learn?

- Pretty chart but not easy to interpret. 

---
# Pie charts


```r
ggplot(tb_us, aes(x = 1, y = count, fill = factor(year))) +
  geom_bar(stat = "identity", position="fill") +
  facet_grid(gender ~ age) +
  coord_polar(theta="y") +
  theme(axis.text = element_blank())
```

&lt;img src="index_files/figure-html/unnamed-chunk-11-1.png" style="display: block; margin: auto;" /&gt;

---

What do we learn?

- Pretty chart but not easy to interpret, or make comparisons across age groups. 

---
class: inverse middle 
# Your turn

How would you describe this plot?

&lt;img src="index_files/figure-html/unnamed-chunk-12-1.png" style="display: block; margin: auto;" /&gt;

---
class: inverse middle 
# Your turn

What about this one?

&lt;img src="index_files/figure-html/unnamed-chunk-13-1.png" style="display: block; margin: auto;" /&gt;

---
# Using the package ggplot2

Elements of a plot

- data
- aesthetics: mapping of variables to graphical elements
- geom: type of plot structure to use
- transformations: log scale, ...

Additional components 

- layers: multiple geoms, multiple data sets, annotation
- facets: show subsets in different plots
- themes: modifying style

---
# Why use a grammar of graphics?

&lt;br&gt;
&lt;br&gt;
&lt;font face="DidyBold" size=6&gt;
Variable in the data is directly mapped to an element in the plot &lt;/font&gt;

---
# Data - Autism


```
Observations: 604
Variables: 7
$ childid  &lt;int&gt; 1, 1, 1, 1, 1, 10, 10, 10, 10, 100, 100, 100, 100, 10...
$ sicdegp  &lt;fct&gt; high, high, high, high, high, low, low, low, low, hig...
$ age2     &lt;dbl&gt; 0, 1, 3, 7, 11, 0, 1, 7, 11, 0, 1, 3, 7, 0, 1, 7, 11,...
$ vsae     &lt;int&gt; 6, 7, 18, 25, 27, 9, 11, 18, 39, 15, 24, 37, 135, 8, ...
$ gender   &lt;fct&gt; male, male, male, male, male, male, male, male, male,...
$ race     &lt;fct&gt; white, white, white, white, white, white, white, whit...
$ bestest2 &lt;fct&gt; pdd, pdd, pdd, pdd, pdd, autism, autism, autism, auti...
```

---
# Plotting points

&lt;img src="index_files/figure-html/unnamed-chunk-15-1.png" style="display: block; margin: auto;" /&gt;

---
class: inverse middle 
# Your turn

![](lorikeets.png)

How is the data mapped to graphical elements?

- data: _______
- aesthetics: _________
- geom: ________
- transformations: _________



---
# Jittering points

&lt;img src="index_files/figure-html/unnamed-chunk-17-1.png" style="display: block; margin: auto;" /&gt;

---
class: inverse middle 
# Your turn

![](lorikeets.png)

How is the data mapped to graphical elements?

- data: _______
- aesthetics: _________
- geom: ________
- transformations: _________



---
# Adding lines

&lt;img src="index_files/figure-html/unnamed-chunk-19-1.png" style="display: block; margin: auto;" /&gt;

---
# Not the lines we want

&lt;img src="index_files/figure-html/unnamed-chunk-20-1.png" style="display: block; margin: auto;" /&gt;

---
# Too much ink

&lt;img src="index_files/figure-html/unnamed-chunk-21-1.png" style="display: block; margin: auto;" /&gt;

---
# Log scale y?

&lt;img src="index_files/figure-html/unnamed-chunk-22-1.png" style="display: block; margin: auto;" /&gt;&lt;img src="index_files/figure-html/unnamed-chunk-22-2.png" style="display: block; margin: auto;" /&gt;

---
# By age 2 diagnosis

&lt;img src="index_files/figure-html/unnamed-chunk-23-1.png" style="display: block; margin: auto;" /&gt;

---
# Refine groups

&lt;img src="index_files/figure-html/unnamed-chunk-24-1.png" style="display: block; margin: auto;" /&gt;

---
class: inverse middle 
# Your turn

![](lorikeets.png)

What do we learn about autism, age, and the diagnosis at age 2?



---
class: inverse middle 
# Your turn

![](lorikeets.png)

How is the data mapped to graphical elements?

- data: _______
- aesthetics: _________
- geom: ________
- transformations: _________



---
# A different look

&lt;img src="index_files/figure-html/unnamed-chunk-27-1.png" style="display: block; margin: auto;" /&gt;

That's not what I wanted ....

---
# For each age measured

&lt;img src="index_files/figure-html/unnamed-chunk-28-1.png" style="display: block; margin: auto;" /&gt;

---
# Which is better?

&lt;img src="index_files/figure-html/unnamed-chunk-29-1.png" style="display: block; margin: auto;" /&gt;

---
# New example - Flying etiquette

[41% Of Fliers Think Youâ€™re Rude If You Recline Your Seat](http://fivethirtyeight.com/datalab/airplane-etiquette-recline-seat/)


```
Observations: 1,040
Variables: 27
$ RespondentID                                                                                                                               &lt;dbl&gt; ...
$ `How often do you travel by plane?`                                                                                                        &lt;chr&gt; ...
$ `Do you ever recline your seat when you fly?`                                                                                              &lt;chr&gt; ...
$ `How tall are you?`                                                                                                                        &lt;int&gt; ...
$ `Do you have any children under 18?`                                                                                                       &lt;chr&gt; ...
$ `In a row of three seats, who should get to use the two arm rests?`                                                                        &lt;chr&gt; ...
$ `In a row of two seats, who should get to use the middle arm rest?`                                                                        &lt;chr&gt; ...
$ `Who should have control over the window shade?`                                                                                           &lt;chr&gt; ...
$ `Is itrude to move to an unsold seat on a plane?`                                                                                          &lt;chr&gt; ...
$ `Generally speaking, is it rude to say more than a few words tothe stranger sitting next to you on a plane?`                               &lt;chr&gt; ...
$ `On a 6 hour flight from NYC to LA, how many times is it acceptable to get up if you're not in an aisle seat?`                             &lt;chr&gt; ...
$ `Under normal circumstances, does a person who reclines their seat during a flight have any obligation to the person sitting behind them?` &lt;chr&gt; ...
$ `Is itrude to recline your seat on a plane?`                                                                                               &lt;chr&gt; ...
$ `Given the opportunity, would you eliminate the possibility of reclining seats on planes entirely?`                                        &lt;chr&gt; ...
$ `Is it rude to ask someone to switch seats with you in order to be closer to friends?`                                                     &lt;chr&gt; ...
$ `Is itrude to ask someone to switch seats with you in order to be closer to family?`                                                       &lt;chr&gt; ...
$ `Is it rude to wake a passenger up if you are trying to go to the bathroom?`                                                               &lt;chr&gt; ...
$ `Is itrude to wake a passenger up if you are trying to walk around?`                                                                       &lt;chr&gt; ...
$ `In general, is itrude to bring a baby on a plane?`                                                                                        &lt;chr&gt; ...
$ `In general, is it rude to knowingly bring unruly children on a plane?`                                                                    &lt;chr&gt; ...
$ `Have you ever used personal electronics during take off or landing in violation of a flight attendant's direction?`                       &lt;chr&gt; ...
$ `Have you ever smoked a cigarette in an airplane bathroom when it was against the rules?`                                                  &lt;chr&gt; ...
$ Gender                                                                                                                                     &lt;chr&gt; ...
$ Age                                                                                                                                        &lt;chr&gt; ...
$ `Household Income`                                                                                                                         &lt;chr&gt; ...
$ Education                                                                                                                                  &lt;chr&gt; ...
$ `Location (Census Region)`                                                                                                                 &lt;chr&gt; ...
```

---
# Variables

- Mix of categorical and quantiative variables. 
- What mappings are appropriate? 
- Area for counts of categories, 
- side-by-side boxplots for mixed pair. 

---
# Support

&lt;img src="index_files/figure-html/unnamed-chunk-31-1.png" style="display: block; margin: auto;" /&gt;

Categories are not sorted

---
# Sorted categories

&lt;img src="index_files/figure-html/unnamed-chunk-32-1.png" style="display: block; margin: auto;" /&gt;&lt;img src="index_files/figure-html/unnamed-chunk-32-2.png" style="display: block; margin: auto;" /&gt;

---
# Filter data



---
# Recline by height

&lt;img src="index_files/figure-html/unnamed-chunk-34-1.png" style="display: block; margin: auto;" /&gt;


---
class: inverse middle 
# Your turn

![](lorikeets.png)

- Take a look at the ggplot2 [Cheat sheet](https://www.rstudio.com/wp-content/uploads/2016/11/ggplot2-cheatsheet-2.1.pdf)
- How many geoms are available in ggplot2? What is `geom_rug`?




---
class: inverse middle 
# Your turn

![](lorikeets.png)


What is the difference between `colour` and `fill`?



---
class: inverse middle 
# Your turn

![](lorikeets.png)

What does `coord_fixed()` do? What is the difference between this and using `theme(aspect.ratio=...)`?



---
class: inverse middle 
# Your turn

![](lorikeets.png)

What are scales? How many numeric transformation scales are there?



---
class: inverse middle 
# Your turn

![](lorikeets.png)

What are position adjustments? When would they be used?



---
class: inverse middle 
# Your turn 

![](lorikeets.png)

Use your cheat sheet to work out how to make plot to explore the relationship between 

`Do you ever recline your seat when you fly?` and `Is it rude to recline your seat on a plane?`





---
# Facets

&lt;img src="index_files/figure-html/unnamed-chunk-41-1.png" style="display: block; margin: auto;" /&gt;

---
# Facets

&lt;img src="index_files/figure-html/unnamed-chunk-42-1.png" style="display: block; margin: auto;" /&gt;

---
# Color palettes - default

&lt;img src="index_files/figure-html/unnamed-chunk-43-1.png" style="display: block; margin: auto;" /&gt;

What do we learn?

---
# Color palettes - brewer

&lt;img src="index_files/figure-html/unnamed-chunk-44-1.png" style="display: block; margin: auto;" /&gt;

---
# Color blind-proofing



---

![](index_files/figure-html/unnamed-chunk-46-1.png)![](index_files/figure-html/unnamed-chunk-46-2.png)

---
# Perceptual principles

- Hierarchy of mappings: (first) position along an axis - (last) color (Cleveland, 1984; Heer and Bostock, 2009)
- Pre-attentive: Some elements are noticed before you even realise it.
- Color: (pre-attentive) palettes - qualitative, sequential, diverging.
- Proximity: Place elements for primary comparison close together. 
- Change blindness: When focus is interrupted differences may not be noticed.

---
# Hierarchy of mappings

- 1.Position - common scale (BEST)
- 2.Position - nonaligned scale
- 3.Length, direction, angle
- 4.Area
- 5.Volume, curvature
- 6.Shading, color (WORST)

---
# Pre-attentive

Can you find the odd one out?

&lt;img src="index_files/figure-html/unnamed-chunk-47-1.png" style="display: block; margin: auto;" /&gt;

---

Is it easier now?

&lt;img src="index_files/figure-html/unnamed-chunk-48-1.png" style="display: block; margin: auto;" /&gt;


---
# Color palettes

- Qualitative: categorical variables
- Sequential: low to high numeric values
- Diverging: negative to positive values

---

&lt;img src="index_files/figure-html/unnamed-chunk-49-1.png" style="display: block; margin: auto;" /&gt;


---
# Proximity



With this arrangement we can see proportion of gender within each rudeness category, and compare these across age groups.  How could we arrange this differently?

---


&lt;img src="index_files/figure-html/unnamed-chunk-51-1.png" style="display: block; margin: auto;" /&gt;


---
# Proximity



---

&lt;img src="index_files/figure-html/unnamed-chunk-53-1.png" style="display: block; margin: auto;" /&gt;

What is different about the comparison now?

---
# Another arrangement



---

&lt;img src="index_files/figure-html/unnamed-chunk-55-1.png" style="display: block; margin: auto;" /&gt;

---
# Themes

The `ggthemes` package has many different styles for the plots. Other packages such as `xkcd`, `skittles`, `wes anderson`, `beyonce`, ....



See the [vignette](https://cran.r-project.org/web/packages/xkcd/vignettes/xkcd-intro.pdf) for instructions on installing the xkcd font. 

---

&lt;img src="index_files/figure-html/unnamed-chunk-57-1.png" style="display: block; margin: auto;" /&gt;

---
class: inverse middle 
# Your turn

![](lorikeets.png)

Compile the rmarkdown document that you have put together thus far in the workshop!

---
# Resources

- ggplot2 [Cheat sheet](https://www.rstudio.com/wp-content/uploads/2016/11/ggplot2-cheatsheet-2.1.pdf)
- [ggplot2: Elegant Graphics for Data Analysis, Hadley Wickham](http://ggplot2.org/book/), [web site](http://ggplot2.org)
- [R Graphics Cookbook, Winston Chang](http://www.cookbook-r.com/Graphs/)
- [Naomi Robbins, Creating More Effective Graphs](http://www.nbr-graphs.com)
- [Antony Unwin, Graphical Data Analysis with R](https://www.crcpress.com/Graphical-Data-Analysis-with-R/Unwin/9781498715232)

---
# Share and share alike

This work is licensed under the Creative Commons Attribution-Noncommercial 3.0 United States License. To view a copy of this license, visit http://creativecommons.org/licenses/by-nc/3.0/us/ or send a letter to Creative Commons, 171 Second Street, Suite 300, San Francisco, California, 94105, USA.
    </textarea>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function() {
  var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})();</script>

<script>
(function() {
  var i, text, code, codes = document.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
})();
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
